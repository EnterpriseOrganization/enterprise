<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <title>删除会员-WeAdmin Frame型后台管理系统-WeAdmin 1.0</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <link rel="stylesheet" href="../../static/css/font.css">
        <link rel="stylesheet" href="../../static/css/weadmin.css">
        <link rel="stylesheet" href="../../static/css/fontawesome-all.css">
        <script src="../../lib/layui/layui.js" charset="utf-8"></script>
        <script src="../../static/js/eleDel.js" type="text/javascript" charset="utf-8"></script>
        <script>
            var mdata=[]
            var mdatanum=0
        </script>
      
        <script>
            layui.use(['form','table'], function(){
                var $=layui.jquery;
                var table = layui.table;
                var form=layui.form;

                var materialtypeoptions=["sfs","sdfsdf","sdfdsfs"];

                $("#mt").prepend("<option value='null'>配料类型</option>")
                for (var i = 0; i < materialtypeoptions.length; i++) {
                    $("#mt").append("<option value='"+materialtypeoptions[i]+"'>"+materialtypeoptions[i]+"</option>")
                    //alert("<option value='"+materialtypeoptions[i]+"'>"+materialtypeoptions[i]+"</option>")
                    //materialtypeoptions[i]
                }
                form.render('select');


                $.ajax({
                    url:"http://127.0.0.1:8000/bom/material/?name=null&class_obj=null&id=null",
                    type:"GET",
                    xhrFields:{
                        withCredentials:true
                    },
                    success:function(msg){
                        console.log(msg.data)
                        mdata=msg.data

                        tableIns.reload({
                        data:mdata,
                        page:true
                        });

                        mdatanum=mdata.length
                        $("#mdcount").text("共有数据："+mdatanum+"条")
                    },
                    error:function(error){
                        console.log(error)
                        // alert("dsf")
                    }
                });


                //第一个实例
                var tableIns=table.render({
                elem: '#materialtable'
                ,height: 315
                ,data:mdata //数据接口
                ,page: true //开启分页
                ,cols: [[ //表头
                    {field:'',title:'kh',type:'checkbox'}
                  ,{field: 'id', title: 'ID', width:'25%', sort: true}
                  ,{field: 'name', title: '名称', width:'25%'}
                  ,{field: 'class_obj', title: '类别', width:'25%', sort: true}
                  ,{title: '操作', width:'25%',templet:'#med'} 
                ]]
                });        

            });
        </script>
    </head>

    <body>
        <div class="weadmin-nav">
            <span class="layui-breadcrumb">
        <a href="">首页</a>
        <a href="">BOM信息管理</a>
        <a>
          <cite>配料管理</cite></a>
      </span>
            <a class="layui-btn layui-btn-sm" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
                <i class="layui-icon" style="line-height:30px">ဂ</i></a>
        </div>
        <div class="weadmin-body">
            <div class="layui-row">
                <form class="layui-form layui-col-md12 we-search" lay-filter="materialsearch">
                    <i class="fas fa-filter"> </i>
                    <div class="layui-inline">
                        <input class="layui-input" placeholder="名称" name="materialname" >
                    </div>
                    <div class="layui-inline">
                        <select id="mt" name="materialtype" lay-verify="required">

                        </select>
                    </div>
                    <!--
                    <div class="layui-inline">
                        <input class="layui-input" placeholder="￥ 最低价" id="price-low">
                    </div> -
                    <div class="layui-inline">
                        <input class="layui-input" placeholder="￥ 最高价" id="price-high">
                    </div>
                    -->
                    <button class="layui-btn layui-btn-normal" lay-submit="" lay-filter="search"><i class="fas fa-search"></i></button>
                </form>
            </div>
            <div class="weadmin-block">
                <button class="layui-btn layui-btn-danger" onclick="delAll()"><i class="layui-icon">&#xe640;</i>批量删除</button>
                <button class="layui-btn" onclick="WeAdminShow('创建物料','./CreateParets.html',550,405)"><i class="fas fa-plus"></i> 创建物料</button>
                <button class="layui-btn" onclick=""><i class="fas fa-share"></i> 全部导出</button>
                <span class="fr" style="line-height:40px" id="mdcount"></span>
            </div>

        <table id="materialtable" lay-filter="test"></table>

        </div>


        <script>
            layui.use(['form','table'], function(){
                var $=layui.jquery;
                var table = layui.table;
                var form=layui.form;
                //第一个实例
                var tableIns=table.render({
                elem: '#materialtable'
                ,height: 315
                ,data:mdata //数据接口
                ,page: true //开启分页
                ,cols: [[ //表头
                    {field:'',title:'kh',type:'checkbox'}
                  ,{field: 'id', title: 'ID', width:'25%', sort: true}
                  ,{field: 'name', title: '名称', width:'25%'}
                  ,{field: 'class_obj', title: '类别', width:'25%', sort: true}
                  ,{title: '操作', width:'25%',templet:'#med'} 
                ]]
                });

                form.on('submit(search)',function(data){
                    var materialname=data.field.materialname
                    var materialtype=data.field.materialtype
                    if(materialname==""){
                        materialname="null";
                    }
                    // alert(materialname)
                    var urltogo="http://127.0.0.1:8000/bom/material/?name="+materialname+"&class_obj="+materialtype+"&id=null";
                    // alert(urltogo)
                    $.ajax({
                        url:urltogo,
                        type:"GET",
                        xhrFields:{
                            withCredentials:true
                        },
                        success:function(msg){
                            console.log(msg.data)
                            mdata=msg.data

                            tableIns.reload({
                            data:mdata,
                            page:true
                            });

                            mdatanum=mdata.length
                            $("#mdcount").text("共有数据："+mdata.length+"条")

                        },
                        error:function(error){
                            console.log(error)
                        }

                    });
                    return false;
                });          

                window.member_del = function (obj, id) {
                    var urltogo="http://127.0.0.1:8000/bom/material/"+id;
                    layer.confirm('确认要删除吗？', function(index) {
                        $.ajax({
                            url:urltogo,
                            type:"DELETE",
                            xhrFields:{
                                withCredentials:true
                            },
                            success:function(msg){
                                console.log(msg)

                                mdatanum-=1
                                $("#mdcount").text("共有数据："+mdatanum+"条")

                            },
                            error:function(error){
                                console.log(error)
                            }

                        });
                        $(obj).parents("tr").remove();
                        layer.msg('已删除!', {
                            icon: 1,
                            time: 1000
                        });
                        return false;
                    });
                }

                window.delAll = function () {
                    var checkStatus=table.checkStatus('materialtable');
                    //var data = tableCheck.getData();
                    var urltogo="http://127.0.0.1:8000/bom/material/";
                    layer.confirm('确认要删除这些记录吗？', function(index) {
                        console.log(checkStatus)
                        $.ajax({
                            url:urltogo,
                            type:"DELETE",
                            data:{todelete:checkStatus},
                            dataType:"json",
                            xhrFields:{
                                withCredentials:true
                            },
                            success:function(msg){
                                console.log(msg)

                                mdatanum-=checkStatus.data.length

                                $("#mdcount").text("共有数据："+mdatanum+"条")

                            },
                            error:function(error){
                                console.log(error)
                            }

                        });
                        layer.msg('删除成功', {
                            icon: 1
                        });
                        $(".layui-form-checked").not('.header').parents('tr').remove();
                        return false;
                    });
                }            

            });
        </script>

        <script type="text/html" id="med">
            <a title="修改" onclick="WeAdminShow('编辑配料','./ParetsDetail.html',550,400)" href="javascript:;">
                <i class="fas fa-edit"></i>
            </a>
            <a title="删除" onclick="member_del(this,{{d.id}})" href="javascript:;">
                <i class="fas fa-trash-alt"></i>
            </a>
        </script>
    </body>

</html>